#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘    MemOrg AI - Backend Deployment to Render               â•‘"
echo "â•‘    Connecting Frontend + Backend Under One Product        â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "ğŸ“‹ PRE-DEPLOYMENT CHECKLIST:"
echo "âœ… Backend code pushed to GitHub"
echo "âœ… OpenAI migration complete (GPT-4 + text-embedding-3-small)"
echo "âœ… CORS configured for Vercel frontend"
echo "âœ… Dynamic PORT configuration added"
echo "âœ… Health check endpoint ready (/api/health)"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸš€ PHASE 2: DEPLOY BACKEND TO RENDER"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "MANUAL STEPS (Follow carefully):"
echo ""
echo "1. Go to: https://render.com"
echo "   - Login or create free account"
echo ""
echo "2. Click 'New +' â†’ 'Web Service'"
echo ""
echo "3. Connect GitHub Repository:"
echo "   - Click 'Connect GitHub'"
echo "   - Authorize Render"
echo "   - Select repository: team_P1"
echo "   - Branch: ramtrail"
echo ""
echo "4. Configure Service:"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Name:            memorg-ai-backend                      â”‚"
echo "   â”‚ Region:          Oregon (US West)                       â”‚"
echo "   â”‚ Branch:          ramtrail                               â”‚"
echo "   â”‚ Root Directory:  enterprise-rag                         â”‚"
echo "   â”‚ Runtime:         Python 3                               â”‚"
echo "   â”‚ Build Command:   pip install -r requirements.txt        â”‚"
echo "   â”‚ Start Command:   python api_server.py                   â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "5. Environment Variables (Click 'Advanced' â†’ 'Add Environment Variable'):"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Key: OPENAI_API_KEY                                     â”‚"
echo "   â”‚ Value: sk-proj-...  (your OpenAI API key)              â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "6. Click 'Create Web Service'"
echo "   - Wait 3-5 minutes for deployment"
echo "   - Render will assign a URL like:"
echo "     https://memorg-ai-backend.onrender.com"
echo ""
echo "7. COPY THE BACKEND URL (you'll need it for Phase 3)"
echo ""

read -p "Press ENTER when backend deployment is complete and you have the URL..."

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ”— PHASE 3: CONNECT FRONTEND TO BACKEND"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
read -p "Enter your Render backend URL (e.g., https://memorg-ai-backend.onrender.com): " BACKEND_URL

if [ -z "$BACKEND_URL" ]; then
    echo "âŒ Backend URL is required. Exiting."
    exit 1
fi

echo ""
echo "Updating Vercel environment variable..."
echo ""
echo "MANUAL STEPS:"
echo ""
echo "1. Go to: https://vercel.com/sriram182719-gmailcoms-projects/enterprise-rag-frontend"
echo "2. Click 'Settings' â†’ 'Environment Variables'"
echo "3. Add new variable:"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Key:         NEXT_PUBLIC_API_URL                        â”‚"
echo "   â”‚ Value:       $BACKEND_URL                               â”‚"
echo "   â”‚ Environment: âœ“ Production âœ“ Preview âœ“ Development      â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo "4. Click 'Save'"
echo "5. Go to 'Deployments' â†’ Click '...' on latest â†’ 'Redeploy'"
echo ""

read -p "Press ENTER when Vercel redeploy is complete..."

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… PHASE 4: VERIFICATION"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Testing backend health..."
curl -s "$BACKEND_URL/api/health" | python3 -m json.tool || echo "âš ï¸  Backend not responding yet (may still be starting)"
echo ""
echo "Testing frontend..."
echo "Open: https://enterprise-rag-frontend-pux7d4p5y.vercel.app"
echo ""
echo "VERIFICATION CHECKLIST:"
echo "  â˜ Frontend loads without errors"
echo "  â˜ No CORS errors in browser console (F12)"
echo "  â˜ Chat input appears"
echo "  â˜ Type a test question and send"
echo "  â˜ AI response appears"
echo "  â˜ Sources display (if available)"
echo "  â˜ Confidence badge shows"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ‰ DEPLOYMENT COMPLETE!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Your MemOrg AI platform is now live:"
echo ""
echo "ğŸŒ Frontend: https://enterprise-rag-frontend-pux7d4p5y.vercel.app"
echo "âš™ï¸  Backend:  $BACKEND_URL"
echo ""
echo "ğŸ“Š Final Architecture:"
echo ""
echo "    User Browser"
echo "         â†“"
echo "    Vercel (Frontend - Next.js)"
echo "         â†“ HTTPS"
echo "    Render (Backend - Flask API)"
echo "         â†“ HTTPS"
echo "    OpenAI (GPT-4 + Embeddings)"
echo ""
echo "âœ¨ ONE cohesive product experience!"
echo ""
echo "ğŸ“– For detailed docs, see: RENDER_DEPLOYMENT.md"
echo ""
